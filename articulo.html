<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="dynamic-title">Art√≠culo - Barillas, Colindres & Asociados</title>
  <meta name="description" id="dynamic-description" content="Consulta nuestros art√≠culos legales especializados en derecho guatemalteco.">

  <!-- Fuentes modernas -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    :root {
      --primary-gold: #ffd700;
      --primary-blue: #39a9e0;
      --dark-blue: #003366;
      --accent-red: #900;
      --text-dark: #2d3748;
      --text-light: #718096;
      --bg-article: rgba(255, 255, 250, 0.97);
      --border-radius: 16px;
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.16);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
  </style>
</head>
<body>
  <header class="header-blog">
    <div class="header-content">
      <a href="index.html" class="logo-blog">
        <img src="images/logo.webp" alt="Logo" />
        <span class="logo-text">Barillas, Colindres & Asociados</span>
      </a>
      <nav class="nav-breadcrumb">
        <a href="index.html">Inicio</a> / <a href="index.html#blog">Blog</a> / <span id="breadcrumb-title">Art√≠culo</span>
      </nav>
    </div>
  </header>

  <div class="contenedor">
    <article class="article-container">
      <header class="article-header">
        <div class="article-meta" id="article-meta">
          <div class="meta-item"><i class="fas fa-calendar"></i> <span id="article-date">Cargando...</span></div>
          <div class="meta-item"><i class="fas fa-user"></i> <span>Barillas, Colindres & Asociados</span></div>
          <div class="meta-item"><i class="fas fa-clock"></i> <span id="reading-time">Cargando...</span></div>
        </div>
        <h1 class="article-title" id="article-title">Cargando art√≠culo...</h1>
      </header>

      <div class="article-content">
        <div id="contenido-articulo" class="loading">
          <p>Cargando contenido del art√≠culo...</p>
        </div>
      </div>

      <footer class="article-navigation">
        <a href="index.html#blog" class="btn-back"><i class="fas fa-arrow-left"></i> Volver al blog</a>
        <div class="social-share">
          <a href="#" class="share-btn facebook" onclick="compartirFacebook()" title="Compartir en Facebook"><i class="fab fa-facebook-f"></i></a>
          <a href="#" class="share-btn twitter" onclick="compartirTwitter()" title="Compartir en Twitter"><i class="fab fa-twitter"></i></a>
          <a href="#" class="share-btn linkedin" onclick="compartirLinkedIn()" title="Compartir en LinkedIn"><i class="fab fa-linkedin-in"></i></a>
          <a href="#" class="share-btn whatsapp" onclick="compartirWhatsApp()" title="Compartir en WhatsApp"><i class="fab fa-whatsapp"></i></a>
        </div>
      </footer>
    </article>
  </div>

  <script>
    function obtenerParametro(nombre) {
      const params = new URLSearchParams(window.location.search);
      return params.get(nombre);
    }

    function estimarTiempoLectura(texto) {
      const palabrasPorMinuto = 200;
      const palabras = texto.trim().split(/\s+/).length;
      const minutos = Math.ceil(palabras / palabrasPorMinuto);
      return `${minutos} min lectura`;
    }

    function actualizarMetaTags(title, description) {
      document.title = `${title} - Barillas, Colindres & Asociados`;
      const metaDesc = document.getElementById('dynamic-description');
      if (metaDesc) metaDesc.content = description || `${title} - Art√≠culo legal especializado`;
      const breadcrumb = document.getElementById('breadcrumb-title');
      if (breadcrumb) breadcrumb.textContent = title.length > 30 ? title.substring(0,30)+'...' : title;
    }

    function compartirFacebook() {
      const url = encodeURIComponent(window.location.href);
      const title = encodeURIComponent(document.getElementById('article-title').textContent);
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${title}`, '_blank', 'width=600,height=400');
    }
    function compartirTwitter() {
      const url = encodeURIComponent(window.location.href);
      const title = encodeURIComponent(document.getElementById('article-title').textContent);
      window.open(`https://twitter.com/intent/tweet?url=${url}&text=${title}`, '_blank', 'width=600,height=400');
    }
    function compartirLinkedIn() {
      const url = encodeURIComponent(window.location.href);
      window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank', 'width=600,height=400');
    }
    function compartirWhatsApp() {
      const url = encodeURIComponent(window.location.href);
      const title = encodeURIComponent(document.getElementById('article-title').textContent);
      window.open(`https://wa.me/?text=${title} ${url}`, '_blank');
    }

    function generarJSONLD(info) {
      const jsonld = {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": info.title,
        "alternativeHeadline": info.title,
        "image": info.image || "https://consultoria-legal-guatemala.netlify.app/img/logo-colindres-aqua.png",
        "editor": "Colindres Barillas & Asociados",
        "genre": info.category,
        "keywords": info.keywords,
        "wordcount": info.wordcount || "",
        "url": info.url,
        "datePublished": info.date,
        "dateModified": info.date,
        "description": info.description,
        "author": {"@type":"Organization","name":"Colindres Barillas & Asociados"},
        "publisher": {
          "@type":"Organization",
          "name":"Colindres Barillas & Asociados",
          "logo":{"@type":"ImageObject","url":"https://consultoria-legal-guatemala.netlify.app/img/logo-colindres-aqua.png"}
        }
      };
      const script = document.createElement('script');
      script.type = "application/ld+json";
      script.textContent = JSON.stringify(jsonld, null, 2);
      document.head.appendChild(script);
    }

    function cargarArticulo() {
      const archivo = obtenerParametro("archivo");
      const contenedor = document.getElementById("contenido-articulo");

      if (!archivo) {
        contenedor.innerHTML = `
          <div class="error">
            <i class="fas fa-file-alt"></i>
            <h3>No se especific√≥ ning√∫n art√≠culo</h3>
            <p>No se ha proporcionado un archivo de art√≠culo para mostrar.</p>
          </div>`;
        return;
      }

      // üîπ CORREGIDO: ruta de index.json
      fetch('index.json')
        .then(res => res.json())
        .then(indexData => {
          const info = indexData.find(a => a.archivo === archivo);
          if (!info) throw new Error("Art√≠culo no encontrado en index.json");

          document.getElementById('article-title').textContent = info.title;
          document.getElementById('article-date').textContent = info.date;
          document.getElementById('reading-time').textContent = estimarTiempoLectura(info.description);
          actualizarMetaTags(info.title, info.description);

          fetch('articulos/' + info.archivo)
            .then(res => {
              if (!res.ok) throw new Error(`HTTP ${res.status}`);
              return res.text();
            })
            .then(md => {
              const limpio = md.replace(/^---[\\s\\S]*?---/, "").trim();
              contenedor.innerHTML = marked.parse(limpio);
              contenedor.className = "";

              document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e){
                  e.preventDefault();
                  const target = document.querySelector(this.getAttribute('href'));
                  if (target) target.scrollIntoView({behavior:'smooth', block:'start'});
                });
              });

              generarJSONLD(info);
            });
        })
        .catch(error => {
          console.error(error);
          contenedor.innerHTML = `
            <div class="error">
              <i class="fas fa-exclamation-triangle"></i>
              <h3>No se pudo cargar el art√≠culo</h3>
              <p>${error.message}</p>
            </div>`;
        });
    }

    cargarArticulo();
  </script>
</body>
</html>

